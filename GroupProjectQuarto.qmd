---
title: "GroupProjectQuarto"
author: "Claire Savage, Dani Wells, Abby drongpa"
format: html
editor: visual
code-fold: true
self-contained: true
execute: 
  error: true
  echo: true
  message: false
  warning: false
---

```{r setup}
library(tidyverse)
library(here)
CO2_emissions <- read_csv(here::here("co2_cons.csv"))
lex_data <- read_csv(here::here("lex.csv"))
```

## Data and Variable Descriptions

For this project we will be looking at the Relationship between life expectancy at birth and total CO2 emissions. We will be using the "Life expectancy, at birth" and "Consumption CO2 emissions, million tonnes" variables from Gapminder in our analysis. Life expectancy at birth is measured in years and measures the number of years an infant born in the given country in the given year would live if mortality rates stay the same throughout its life. Total CO2 emissions is measured in million tonnes and is the total carbon dioxide emitted from each country per Capita.

Our cleaned data sets are separated by country and year with each row being a the specific life expectancy and CO2 emissions for that country in that year. We decided to look at at a century's worth of data from the years 1920 - 2020. Countries with NAs for values within these years were removed.

## Hypothesized Relationship

We believe that increased levels of CO2 emission decrease life expectancy. According to a study conducted by the [National Library of Medicine](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8782287/#:~:text=Carbon%20emissions%20have%20a%20significantly,decreases%20life%20expectancy%20by%200.012%25.), “Carbon emissions have a significantly negative impact on life expectancy, suggesting that higher the carbon emissions lower the life expectancy.” Which is in line with the harmful effects we know CO2 has on the human body.

## Data Cleaning

```{r}
CO2_emissions_clean <- CO2_emissions %>%
  mutate(across(c(`2003`:`2006`,`2011`:`2013`), as.numeric)) %>% 
  select(country, `1920`:`2020`) %>% 
  pivot_longer(cols = `1920`:`2020`,
               names_to = "year",
               values_to = "emissions")
```

```{r}
lex_clean <- lex_data %>%
  select(country, `1920`:`2020`) %>%
  filter(if_all(c(`1920`:`2020`), ~ !is.na(.))) %>%
  pivot_longer(cols = `1920`:`2020`,
               names_to = "year",
               values_to = "life_exp")
```

```{r}
co2life_clean <- inner_join(CO2_emissions_clean, lex_clean)
```

## Data Visualization

-   Present and discuss the visualizations of the relationship between the variables

-   Describe the statistical method used – linear regression

-   Present the estimated regression model (in notation)

-   Interpret the Linear Regression coefficients (in context)

-   Describe the fit of the regression model (both table and written format)

```{r}
#The relationship between the two quantitative variables changing over time. Get creative!
```

```{r}
#The relationship between the two quantitative variables you are investigating.

co2_life_twodecade <- co2life_clean|>
  mutate(
    year = as.factor(year)
  )|>
  mutate(
    twodecade = fct_collapse(year, 
                          y1920_1940 = c(
                            "1920",
                            "1921",
                            ...
                            "1940"),
                          North_Coast = c(
                            "Del Norte County", 
                            "Humboldt County", 
                            "Lake County", 
                            "Mendocino County", 
                            "Napa County", 
                            "Sonoma County", 
                            "Trinity County"),
                          SF_Bay_Area         = c(
                            "Alameda County", 
                            "Contra Costa County", 
                            "Marin County", 
                            "San Francisco County", 
                            "San Mateo County", 
                            "Santa Clara County", 
                            "Solano County"),
                          Northern_SJ_Valley  = c(
                            "Alpine County", 
                            "Amador County", 
                            "Calaveras County", 
                            "Madera County", 
                            "Mariposa County", 
                            "Merced County", 
                            "Mono County", 
                            "San Joaquin County", 
                            "Stanislaus County", 
                            "Tuolumne County"),
                          Central_Coast       = c(
                            "Monterey County",
                            "San Benito County",
                            "San Luis Obispo County",
                            "Santa Barbara County",
                            "Santa Cruz County",
                            "Ventura County"),
                          Southern_SJ_Valley = c(
                            "Fresno County",
                            "Inyo County",
                            "Kern County",
                            "Kings County",
                            "Tulare County"),
                          Inland_Empire = c(
                            "Riverside County",
                            "San Bernardino County"),
                          LA_County = c("Los Angeles County"),
                          Orange_County = c("Orange County"),
                          SD_Imperial = c(
                            "Imperial County",
                            "San Diego County"
                            )
                          )
    )
```

**Hint: In investigating this relationship, you may want to first average over the years for each country (i.e., one observational row per country since our independence condition would be violated).**

## Linear Regression

Your final report should present the estimated regression model *and* provide an interpretation for each of the coefficients output.

```{r}
mod_co2life <- lm(life_exp ~ emissions, data = co2life_clean)
summary(mod_co2life)
```

## Model Fit

Make a nicely formatted table that presents the following:

-   The variance in the response values

-   The variance in the fitted values from your regression model

-   The variance in the residuals from your regression model

Discuss the proportion of the variability in the response values that was accounted for by your regression model. What does this suggest about the “quality” of your model?

```{r}

```

**Hint: The goal of regression is to account for as much variability in the *response* values as we can. Here, the variance in the *fitted values* represents the amount of variability in the response that was accounted for by the explanatory variable. The variance in the *residuals* represents the amount of variability in the responses that has *not* been accounted for.**
